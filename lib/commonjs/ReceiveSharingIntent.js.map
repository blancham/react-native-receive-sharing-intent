{"version":3,"sources":["ReceiveSharingIntent.ts"],"names":["ReceiveSharingIntent","NativeModules","ReceiveSharingIntentModule","Platform","OS","Utils","getReceivedFiles","handler","errorHandler","protocol","isIos","Linking","getInitialURL","then","res","startsWith","isClear","getFileNames","catch","addEventListener","url","AppState","status","clearReceivedFiles","data","files","utils","sortData","e","fileObject","Object","keys","map","k"],"mappings":";;;;;;;AAIA;;AACA;;;;;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAA2BC,0BAAjC;;AAEA,MAAMC,0BAAN,CAAkE;AAAA;AAAA,mCACvCC,sBAASC,EAAT,KAAgB,KADuB;;AAAA,mCAExC,IAAIC,cAAJ,EAFwC;;AAAA,qCAGrC,KAHqC;AAAA;;AAKhEC,EAAAA,gBAAgB,CACdC,OADc,EAEdC,YAFc,EAGdC,QAAgB,GAAG,YAHL,EAId;AACA,QAAI,KAAKC,KAAT,EAAgB;AACdC,2BAAQC,aAAR,GACGC,IADH,CACSC,GAAD,IAAc;AAClB,YAAI,CAACA,GAAL,EAAU;AACR,iBAAOP,OAAO,CAAC,EAAD,CAAd;AACD;;AACD,YAAIO,GAAG,CAACC,UAAJ,CAAgB,GAAEN,QAAS,YAA3B,KAA2C,CAAC,KAAKO,OAArD,EAA8D;AAC5D,eAAKC,YAAL,CAAkBV,OAAlB,EAA2BC,YAA3B,EAAyCM,GAAzC;AACD;AACF,OARH,EASGI,KATH,CASS,MAAM,CAAE,CATjB;;AAUAP,2BAAQQ,gBAAR,CAAyB,KAAzB,EAAiCL,GAAD,IAAc;AAC5C,cAAMM,GAAG,GAAGN,GAAG,GAAGA,GAAG,CAACM,GAAP,GAAa,EAA5B;;AACA,YAAIA,GAAG,CAACL,UAAJ,CAAgB,GAAEN,QAAS,YAA3B,KAA2C,CAAC,KAAKO,OAArD,EAA8D;AAC5D,eAAKC,YAAL,CAAkBV,OAAlB,EAA2BC,YAA3B,EAAyCM,GAAG,CAACM,GAA7C;AACD;AACF,OALD;AAMD,KAjBD,MAiBO;AACLC,4BAASF,gBAAT,CAA0B,QAA1B,EAAqCG,MAAD,IAAoB;AACtD,YAAIA,MAAM,KAAK,QAAX,IAAuB,CAAC,KAAKN,OAAjC,EAA0C;AACxC,eAAKC,YAAL,CAAkBV,OAAlB,EAA2BC,YAA3B,EAAyC,EAAzC;AACD;AACF,OAJD;;AAKA,UAAI,CAAC,KAAKQ,OAAV,EAAmB,KAAKC,YAAL,CAAkBV,OAAlB,EAA2BC,YAA3B,EAAyC,EAAzC;AACpB;AACF;;AAEDe,EAAAA,kBAAkB,GAAG;AACnB,SAAKP,OAAL,GAAe,IAAf;AACD;;AAESC,EAAAA,YAAY,CACpBV,OADoB,EAEpBC,YAFoB,EAGpBY,GAHoB,EAIpB;AACA,QAAI,KAAKV,KAAT,EAAgB;AACdV,MAAAA,oBAAoB,CAACiB,YAArB,CAAkCG,GAAlC,EACGP,IADH,CACSW,IAAD,IAAe;AACnB,YAAIC,KAAK,GAAG,KAAKC,KAAL,CAAWC,QAAX,CAAoBH,IAApB,CAAZ;AACAjB,QAAAA,OAAO,CAACkB,KAAD,CAAP;AACD,OAJH,EAKGP,KALH,CAKUU,CAAD,IAAYpB,YAAY,CAACoB,CAAD,CALjC;AAMD,KAPD,MAOO;AACL5B,MAAAA,oBAAoB,CAACiB,YAArB,GACGJ,IADH,CACSgB,UAAD,IAAqB;AACzB,YAAI,CAACA,UAAL,EAAiB;AACf,iBAAOtB,OAAO,CAAC,EAAD,CAAd;AACD;;AACD,YAAIkB,KAAK,GAAGK,MAAM,CAACC,IAAP,CAAYF,UAAZ,EAAwBG,GAAxB,CAA6BC,CAAD,IAAOJ,UAAU,CAACI,CAAD,CAA7C,CAAZ;AACA1B,QAAAA,OAAO,CAACkB,KAAD,CAAP;AACD,OAPH,EAQGP,KARH,CAQUU,CAAD,IAAYpB,YAAY,CAACoB,CAAD,CARjC;AASD;AACF;;AAhE+D;;eAmEnD1B,0B","sourcesContent":["import type {\n  IReceiveSharingIntent,\n  IUtils,\n} from './ReceiveSharingIntent.interfaces';\nimport { Platform, Linking, AppState, NativeModules } from 'react-native';\nimport Utils from './utils';\n\nconst { ReceiveSharingIntent } = NativeModules;\n\nclass ReceiveSharingIntentModule implements IReceiveSharingIntent {\n  private isIos: boolean = Platform.OS === 'ios';\n  private utils: IUtils = new Utils();\n  private isClear: boolean = false;\n\n  getReceivedFiles(\n    handler: Function,\n    errorHandler: Function,\n    protocol: string = 'ShareMedia'\n  ) {\n    if (this.isIos) {\n      Linking.getInitialURL()\n        .then((res: any) => {\n          if (!res) {\n            return handler([]);\n          }\n          if (res.startsWith(`${protocol}://dataUrl`) && !this.isClear) {\n            this.getFileNames(handler, errorHandler, res);\n          }\n        })\n        .catch(() => {});\n      Linking.addEventListener('url', (res: any) => {\n        const url = res ? res.url : '';\n        if (url.startsWith(`${protocol}://dataUrl`) && !this.isClear) {\n          this.getFileNames(handler, errorHandler, res.url);\n        }\n      });\n    } else {\n      AppState.addEventListener('change', (status: string) => {\n        if (status === 'active' && !this.isClear) {\n          this.getFileNames(handler, errorHandler, '');\n        }\n      });\n      if (!this.isClear) this.getFileNames(handler, errorHandler, '');\n    }\n  }\n\n  clearReceivedFiles() {\n    this.isClear = true;\n  }\n\n  protected getFileNames(\n    handler: Function,\n    errorHandler: Function,\n    url: string\n  ) {\n    if (this.isIos) {\n      ReceiveSharingIntent.getFileNames(url)\n        .then((data: any) => {\n          let files = this.utils.sortData(data);\n          handler(files);\n        })\n        .catch((e: any) => errorHandler(e));\n    } else {\n      ReceiveSharingIntent.getFileNames()\n        .then((fileObject: any) => {\n          if (!fileObject) {\n            return handler([]);\n          }\n          let files = Object.keys(fileObject).map((k) => fileObject[k]);\n          handler(files);\n        })\n        .catch((e: any) => errorHandler(e));\n    }\n  }\n}\n\nexport default ReceiveSharingIntentModule;\n"]}